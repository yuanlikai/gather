webpackJsonp([28],{W1Am:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={data:function(){var e=this;return{spinShow:!1,roleTree:[],cheTree:[],formValidate:{roleName:"",roleCode:"",remark:"",supplierExclusive:!1,menuIds:!1},data1:[],like:"",ruleValidate:{roleName:[{validator:function(t,a,r){var o=e;a.length<1?r(new Error("请选择角色")):o.Axios.get("/Manage/Role/checkRoleName",{params:{id:""!==o.id?o.id:"",roleName:a}}).then(function(e){0===e.data.code?r():r(new Error(e.data.message))})},required:!0,trigger:"blur"}],roleCode:[{validator:function(t,a,r){var o=e;a.length<1?r(new Error("请选择角色")):o.Axios.get("/Manage/Role/checkRoleCode",{params:{id:""!==o.id?o.id:"",roleCode:a}}).then(function(e){0===e.data.code?r():r(new Error(e.data.message))})},required:!0,trigger:"blur"}],menuIds:[{validator:function(t,a,r){e.cheTree.length<1?r(new Error("请关联菜单")):r()},required:!0,trigger:"change"}]},id:"",addAccount:!1,total:0,loading:!0,modal_loading:!1,columns:[{type:"index",width:50,align:"center"},{title:"角色名称",minWidth:88,key:"roleName",align:"center"},{title:"角色备注",minWidth:88,key:"remark",align:"center"},{title:"供应商是否专属",minWidth:88,key:"status",align:"center",render:function(e,t){return e("p",!0===t.row.supplierExclusive?"是":"否")}},{title:"最后修改时间",minWidth:88,key:"timeModified",align:"center",render:function(t,a){return t("p",e.riqi(a.row.timeModified))}},{title:"操作",align:"center",minWidth:100,maxWidth:180,render:function(t,a){return t("div",[t("a",{on:{click:function(){var t=e;t.spinShow=!0,t.addAccount=!0,t.id=a.row.id,t.handleReset("formValidate"),t.formValidate.remark=a.row.remark,t.formValidate.roleName=a.row.roleName,t.formValidate.roleCode=a.row.roleCode,t.formValidate.supplierExclusive=a.row.supplierExclusive,t.Axios.get("/Manage/Role/getRole",{params:{id:a.row.id}}).then(function(e){if(0===e.data.code){for(var a=e.data.data.menuTreeList,r=[],o=0;o<a.length;o++)a[o].expand=!0===a[o].checked,a[o].checked=!1,r.push(a[o]);t.roleTree=r,setTimeout(function(){t.cheTree=t.$refs.tree.getCheckedNodes()},1)}else t.$Message.error(e.data.message);t.spinShow=!1})}}},"编辑"),t("Divider",{props:{type:"vertical"}}),t("Poptip",{props:{confirm:!0,transfer:!0,placement:"top-end",offset:13,title:"确定删除该角色？"},on:{"on-ok":function(){var t=e;t.Axios.post("/Manage/Role/deleteRole",t.Qs.stringify({ids:[a.row.id]},{indices:!1})).then(function(e){0===e.data.code?(t.getTreeList(),t.$Message.success("删除成功")):t.$Message.error(e.data.message)})}}},[t("a","删除")])])}}],data:[]}},methods:{getTree:function(){var e=this;e.Axios.get("/Manage/Menu/tree").then(function(t){e.roleTree=t.data.data})},addRole:function(){this.getTree(),this.id="",this.handleReset("formValidate"),this.addAccount=!0},getTreeList:function(){var e=this;e.loading=!0,e.Axios.get("/Manage/Role/pageList",{params:{start:e.start,size:14,roleNameLike:""}}).then(function(t){0===t.data.code?e.data=t.data.data.content:e.$Message.error(t.data.message),e.loading=!1,e.total=t.data.data.totalElements})},handleSubmit:function(e){var t=this;t.$refs[e].validate(function(e){if(e){t.modal_loading=!0;var a=[];for(var r in t.cheTree)a.push(t.cheTree[r].id);""===t.id?t.Axios.post("/Manage/Role/addRole",t.Qs.stringify({roleName:t.formValidate.roleName,roleCode:t.formValidate.roleCode,remark:t.formValidate.remark,menuIds:a,supplierExclusive:t.formValidate.supplierExclusive},{indices:!1})).then(function(e){0===e.data.code?(t.addAccount=!1,t.getTreeList(),t.$Message.success("添加成功")):t.$Message.error(e.data.message),t.modal_loading=!1}):t.Axios.post("/Manage/Role/updateRole",t.Qs.stringify({id:t.id,roleName:t.formValidate.roleName,roleCode:t.formValidate.roleCode,remark:t.formValidate.remark,menuIds:a,supplierExclusive:t.formValidate.supplierExclusive},{indices:!1})).then(function(e){0===e.data.code?(t.addAccount=!1,t.getTreeList(),t.$Message.success("修改成功")):t.$Message.error(e.data.message),t.modal_loading=!1})}else t.$Message.error("有必填项未填写!")})},handleReset:function(e){this.$refs[e].resetFields()},checkTree:function(e){this.cheTree=this.$refs.tree.getCheckedAndIndeterminateNodes()}},mounted:function(){this.getTreeList()}},o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"content"},[a("Card",{staticStyle:{border:"none",margin:"16px 0"}},[a("div",{staticClass:"ivu-page-header-title"},[e._v("角色管理")])]),e._v(" "),a("Card",{style:{margin:"0 20px 20px 20px",background:"#fff",height:"auto"}},[e.loading?a("Spin",{attrs:{fix:""}}):e._e(),e._v(" "),a("p",{attrs:{slot:"title"},slot:"title"},[e._v("\n      基础列表\n    ")]),e._v(" "),a("Button",{staticStyle:{width:"100%","margin-bottom":"16px"},attrs:{type:"dashed"},on:{click:function(t){e.addRole()}}},[e._v("添加")]),e._v(" "),a("Table",{attrs:{"show-header":!0,columns:e.columns,data:e.data}}),e._v(" "),a("div",{staticStyle:{width:"100%",height:"2px",background:"#ffffff","margin-top":"-1px","z-index":"3",position:"relative"}})],1),e._v(" "),a("Modal",{attrs:{width:"300"},model:{value:e.addAccount,callback:function(t){e.addAccount=t},expression:"addAccount"}},[a("p",{attrs:{slot:"header"},slot:"header"},[a("Icon",{attrs:{type:"ios-information-circle"}}),e._v(" "),a("span",[e._v(e._s(""===e.id?"添加":"修改")+"角色")])],1),e._v(" "),a("div",[e.spinShow?a("Spin",{attrs:{size:"large",fix:""}}):e._e(),e._v(" "),a("Form",{ref:"formValidate",attrs:{model:e.formValidate,rules:e.ruleValidate,"label-width":70}},[a("FormItem",{attrs:{label:"角色名称",prop:"roleName"}},[a("Input",{attrs:{maxlength:10,placeholder:"请输入角色名称"},model:{value:e.formValidate.roleName,callback:function(t){e.$set(e.formValidate,"roleName",t)},expression:"formValidate.roleName"}})],1),e._v(" "),a("FormItem",{attrs:{label:"角色编号",prop:"roleCode"}},[a("Input",{attrs:{disabled:""!==e.id,maxlength:10,placeholder:"请输入角色编号"},model:{value:e.formValidate.roleCode,callback:function(t){e.$set(e.formValidate,"roleCode",t)},expression:"formValidate.roleCode"}})],1),e._v(" "),a("FormItem",{attrs:{label:"角色说明",prop:"remark"}},[a("Input",{attrs:{type:"textarea",maxlength:50,placeholder:"请输入角色说明"},model:{value:e.formValidate.remark,callback:function(t){e.$set(e.formValidate,"remark",t)},expression:"formValidate.remark"}})],1),e._v(" "),a("FormItem",{attrs:{"label-width":100,label:"供应商是否专属",prop:"supplierExclusive"}},[a("i-switch",{attrs:{disabled:""!==e.id},model:{value:e.formValidate.supplierExclusive,callback:function(t){e.$set(e.formValidate,"supplierExclusive",t)},expression:"formValidate.supplierExclusive"}},[a("span",{attrs:{slot:"open"},slot:"open"},[e._v("是")]),e._v(" "),a("span",{attrs:{slot:"close"},slot:"close"},[e._v("否")])])],1),e._v(" "),a("FormItem",{attrs:{label:"关联菜单",prop:"menuIds"}},[a("Card",[a("Tree",{ref:"tree",attrs:{data:e.roleTree,"show-checkbox":""},on:{"on-check-change":e.checkTree}})],1)],1)],1)],1),e._v(" "),a("div",{attrs:{slot:"footer"},slot:"footer"},[a("Button",{attrs:{type:"success",size:"large",long:"",loading:e.modal_loading},on:{click:function(t){e.handleSubmit("formValidate")}}},[e._v("\n        "+e._s(""===e.id?"添加":"修改")+"\n      ")])],1)])],1)},staticRenderFns:[]};var i=a("VU/8")(r,o,!1,function(e){a("ZVmp")},"data-v-15c70c50",null);t.default=i.exports},ZVmp:function(e,t){}});
//# sourceMappingURL=28.c9672e536c3204da2ad0.js.map