webpackJsonp([21],{"0i4P":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r={data:function(){return{importOrder:{num1:0,num3:0},importAlert:!1,selectList:[],orderNumList:{},total:0,loading:!1,dataList:[],formValidate:{state:"0",page:1,pagesize:10,sortid:"",platformid:"",supplierid:"",ordernumber:"",begintime:"",endtime:"",begintime2:"",endtime2:"",price1:"",price2:""},terraceList:[],supplierList:[],columns1:[{type:"selection",width:60,_disabled:!0,align:"center"},{title:"平台订单号",align:"center",key:"OrderNumber"},{title:"ERT订单号",align:"center",key:"ErpOrderNumber"},{title:"结算金额",align:"center",width:"100px",key:"Total"},{title:"下单日期",align:"center",key:"AddTime",sortable:"custom"},{title:"发货日期",align:"center",key:"SendTime",sortable:"custom"},{title:"导入日期",align:"center",key:"ImportTime",sortable:"custom"},{title:"操作人",align:"center",width:"100px",key:"Importer"},{title:"来源平台",align:"center",key:"PlatformStr"},{title:"供应商",align:"center",key:"Supplier"},{title:"单据状态",align:"center",key:"ImportStr",width:"100px",render:function(t,e){var i="#515a6e";return"已导入"===e.row.ImportStr?i="#19be6b":"已导入"===e.row.ImportStr&&(i="#ed4014"),t("div",[t("p",{style:{color:i}},e.row.ImportStr)])}},{title:"操作",width:88,align:"center",render:function(t,e){return t("div",[t("router-link",{attrs:{target:"_blank"},props:{to:{path:"/orderDetails",query:{idstr:e.row.ID,vid:1}}}},"订单详情")])}}]}},methods:{importC:function(){var t=this;if(this.selectList.length<1)this.$Message.error("请选择要导入订单");else{this.importAlert=!0,this.importOrder.num1=0,this.importOrder.num3=0;for(var e=function(e){setTimeout(function(){t.ImportToErp(t.selectList[e])},100*e)},i=0;i<this.selectList.length;i++)e(i)}},ImportToErp:function(t){var e=this;this.Axios.post("/ImportToErp.ashx",{id:t,username:localStorage.getItem("user")}).then(function(t){0===t.data.error?e.importOrder.num1=e.importOrder.num1+1:e.importOrder.num3=e.importOrder.num3+1})},stateChange:function(t){"0"!==t&&"selection"===this.columns1[0].type?(this.columns1.splice(0,1),this.selectList=[]):"0"===t&&"selection"!==this.columns1[0].type&&this.columns1.splice(0,0,{type:"selection",width:60,_disabled:!0,align:"center"}),this.reset()},allCancel:function(){for(var t=this.selectList,e=0;e<this.dataList.length;e++)-1!==t.indexOf(this.dataList[e].ID)&&t.splice(t.indexOf(this.dataList[e].ID),1);this.selectList=t},selectCancel:function(t,e){this.selectList.splice(this.selectList.indexOf(e.ID),1)},selectChange:function(t){for(var e=this.selectList,i=0;i<t.length;i++)-1===this.selectList.indexOf(t[i].ID)&&e.push(t[i].ID);this.selectList=e},handleSubmit:function(t){var e=this;console.log(this.formValidate),this.$refs[t].validate(function(t){t?e.reset():e.$Message.error("Fail!")})},getList:function(){var t=this;t.loading=!0,t.Axios.post("/GetDzOrderList.ashx",t.formValidate).then(function(e){console.log(e.data.data),t.dataList=e.data.data,t.total=e.data.total,t.loading=!1;for(var i=0;i<t.dataList.length;i++)-1!==t.selectList.indexOf(t.dataList[i].ID)&&t.$set(t.dataList[i],"_checked",!0)})},handleReset:function(t){this.$refs[t].resetFields(),this.formValidate.time=[],this.formValidate.time1=[],this.formValidate.price2="",this.reset()},getTerrace:function(){var t=this;t.Axios.get("/GetPlaList.ashx").then(function(e){t.terraceList=e.data.data})},getSupplier:function(){var t=this;t.Axios.get("/GetSupList.ashx").then(function(e){t.supplierList=e.data.data})},GetOrderNum:function(){var t=this;t.Axios.get("/GetDzOrderNum.ashx").then(function(e){t.orderNumList=e.data})},reset:function(){this.formValidate.page=1,this.total=0,this.getList()},sortChange:function(t){this.formValidate.sortid="","AddTime"===t.key&&"asc"===t.order?this.formValidate.sortid="1":"AddTime"===t.key&&"desc"===t.order?this.formValidate.sortid="2":"SendTime"===t.key&&"asc"===t.order?this.formValidate.sortid="3":"SendTime"===t.key&&"desc"===t.order?this.formValidate.sortid="4":"ImportTime"===t.key&&"asc"===t.order?this.formValidate.sortid="5":"ImportTime"===t.key&&"desc"===t.order&&(this.formValidate.sortid="6"),this.reset()},paging:function(t){this.formValidate.page=t,this.getList()},getTime:function(t){console.log(t),this.formValidate.begintime=t[0],this.formValidate.endtime=t[1]},getTime1:function(t){console.log(t),this.formValidate.begintime2=t[0],this.formValidate.endtime2=t[1]}},mounted:function(){this.GetOrderNum(),this.getList(),this.getTerrace(),this.getSupplier()}},a={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"app-container"},[i("Card",{staticStyle:{border:"none",margin:"16px 0"}},[i("div",{staticClass:"ivu-page-header-title"},[t._v("电商平台导单")])]),t._v(" "),i("div",{staticStyle:{"min-height":"32px"}},[i("transition",{attrs:{name:"fade"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:t.orderNumList.num1,expression:"orderNumList.num1"}]},[i("RadioGroup",{style:{margin:"0 20px 0 20px",background:"#fff",height:"auto"},attrs:{type:"button"},on:{"on-change":t.stateChange},model:{value:t.formValidate.state,callback:function(e){t.$set(t.formValidate,"state",e)},expression:"formValidate.state"}},[i("Radio",{staticStyle:{padding:"0 20px"},attrs:{label:"-1"}},[t._v("全部 ("+t._s(t.orderNumList.num1)+")")]),t._v(" "),i("Radio",{staticStyle:{padding:"0 20px"},attrs:{label:"0"}},[t._v("待导入 ("+t._s(t.orderNumList.num2)+")")]),t._v(" "),i("Radio",{staticStyle:{padding:"0 20px"},attrs:{label:"1"}},[t._v("已导入 ("+t._s(t.orderNumList.num3)+")")]),t._v(" "),i("Radio",{staticStyle:{padding:"0 20px"},attrs:{label:"2"}},[t._v("导入异常 ("+t._s(t.orderNumList.num4)+")")])],1)],1)])],1),t._v(" "),i("Card",{style:{margin:"16px 20px",background:"#fff",height:"auto"}},[i("p",{attrs:{slot:"title"},slot:"title"},[t._v("\n      筛选查询\n    ")]),t._v(" "),i("Form",{ref:"formValidate",attrs:{model:t.formValidate,"label-width":80}},[i("Row",{attrs:{gutter:30}},[i("Col",{attrs:{xs:24,md:12,lg:8}},[i("FormItem",{attrs:{label:"来源平台：",prop:"platformid"}},[i("Select",{attrs:{clearable:""},model:{value:t.formValidate.platformid,callback:function(e){t.$set(t.formValidate,"platformid",e)},expression:"formValidate.platformid"}},[i("Option",{attrs:{value:"-1"}},[t._v("全部")]),t._v(" "),t._l(t.terraceList,function(e,r){return i("Option",{key:r,attrs:{value:e.id}},[t._v(t._s(e.platformName)+"\n              ")])})],2)],1)],1),t._v(" "),i("Col",{attrs:{xs:24,md:12,lg:8}},[i("FormItem",{attrs:{label:"供应商：",prop:"supplierid"}},[i("Select",{attrs:{clearable:"",filterable:""},model:{value:t.formValidate.supplierid,callback:function(e){t.$set(t.formValidate,"supplierid",e)},expression:"formValidate.supplierid"}},t._l(t.supplierList,function(e,r){return i("Option",{key:r,attrs:{value:e.id}},[t._v(t._s(e.supplierName))])}))],1)],1),t._v(" "),i("Col",{attrs:{xs:24,md:12,lg:8}},[i("FormItem",{attrs:{label:"订单编号：",prop:"ordernumber"}},[i("Input",{attrs:{placeholder:"请输入"},model:{value:t.formValidate.ordernumber,callback:function(e){t.$set(t.formValidate,"ordernumber",e)},expression:"formValidate.ordernumber"}})],1)],1),t._v(" "),i("Col",{attrs:{xs:24,md:12,lg:8}},[i("FormItem",{attrs:{label:"下单时间：",prop:"begTime"}},[i("DatePicker",{staticStyle:{width:"100%"},attrs:{editable:!1,type:"daterange",format:"yyyy-MM-dd",placeholder:"请选择"},on:{"on-change":t.getTime},model:{value:t.formValidate.time,callback:function(e){t.$set(t.formValidate,"time",e)},expression:"formValidate.time"}})],1)],1),t._v(" "),i("Col",{attrs:{xs:24,md:12,lg:8}},[i("FormItem",{attrs:{label:"发货时间：",prop:"GetTime"},model:{value:t.formValidate.time1,callback:function(e){t.$set(t.formValidate,"time1",e)},expression:"formValidate.time1"}},[i("DatePicker",{staticStyle:{width:"100%"},attrs:{editable:!1,type:"daterange",format:"yyyy-MM-dd",placeholder:"请选择"},on:{"on-change":t.getTime1}})],1)],1),t._v(" "),i("Col",{attrs:{xs:24,md:12,lg:8}},[i("FormItem",{attrs:{label:"结算金额：",prop:"price1"}},[i("div",{staticClass:"price-inp"},[i("Input",{attrs:{placeholder:"请输入"},on:{"on-keyup":function(e){t.formValidate.price1=t.formValidate.price1.replace(/[^\d]/g,"")}},model:{value:t.formValidate.price1,callback:function(e){t.$set(t.formValidate,"price1",e)},expression:"formValidate.price1"}}),t._v(" "),i("span",[t._v("-")]),t._v(" "),i("Input",{attrs:{placeholder:"请输入"},on:{"on-keyup":function(e){t.formValidate.price2=t.formValidate.price2.replace(/[^\d]/g,"")}},model:{value:t.formValidate.price2,callback:function(e){t.$set(t.formValidate,"price2",e)},expression:"formValidate.price2"}})],1)])],1),t._v(" "),i("Col",{attrs:{span:"24"}},[i("FormItem",[i("div",{staticStyle:{width:"100%","text-align":"right"}},[i("Button",{staticStyle:{"margin-right":"6px"},attrs:{type:"primary"},on:{click:function(e){t.handleSubmit("formValidate")}}},[t._v("查询")]),t._v(" "),i("Button",{staticStyle:{"margin-right":"6px"},on:{click:function(e){t.handleReset("formValidate")}}},[t._v("重置")])],1)])],1)],1)],1)],1),t._v(" "),i("Card",{style:{margin:"16px 20px",background:"#fff",height:"auto"}},[i("p",{attrs:{slot:"title"},slot:"title"},[t._v("\n      筛选查询\n    ")]),t._v(" "),i("p",{attrs:{slot:"extra"},slot:"extra"},[i("Poptip",{attrs:{confirm:"",placement:"left",title:"是否确认导入ERP?"},on:{"on-ok":t.importC}},["0"===t.formValidate.state?i("Button",{attrs:{type:"text",icon:"ios-cloud-upload"}},[t._v("导入ERP ("+t._s(t.selectList.length)+"条)")]):t._e()],1)],1),t._v(" "),i("Table",{attrs:{columns:t.columns1,loading:t.loading,data:t.dataList},on:{"on-sort-change":t.sortChange,"on-selection-change":t.selectChange,"on-select-cancel":t.selectCancel,"on-select-all-cancel":t.allCancel}}),t._v(" "),i("div",{staticStyle:{width:"100%","text-align":"center","margin-top":"15px"}},[i("Page",{attrs:{total:Number(t.total),"page-size":10,"show-elevator":"","show-total":""},on:{"on-change":t.paging}})],1)],1),t._v(" "),i("Modal",{attrs:{width:"460",closable:!1,"mask-closable":!1},model:{value:t.importAlert,callback:function(e){t.importAlert=e},expression:"importAlert"}},[i("p",{staticStyle:{"text-align":"center"},attrs:{slot:"header"},slot:"header"},[i("Icon",{attrs:{type:"ios-information-circle"}}),t._v(" "),i("span",[t._v("导入ERP")])],1),t._v(" "),i("div",{staticClass:"percent"},[i("i-circle",{attrs:{percent:parseInt((t.importOrder.num1+t.importOrder.num3)/t.selectList.length*100)}},[i("span",{staticClass:"demo-Circle-inner",staticStyle:{"font-size":"24px"}},[t._v(t._s(parseInt((t.importOrder.num1+t.importOrder.num3)/t.selectList.length*100))+"%")])]),t._v(" "),i("div",{staticClass:"percent-ul"},[i("p",{staticStyle:{"font-weight":"700"}},[t._v("应导入："+t._s(t.selectList.length)+"单")]),t._v(" "),i("p",[t._v("已导入："+t._s(t.importOrder.num1)+"单")]),t._v(" "),i("p",[t._v("待导入："+t._s(t.selectList.length-t.importOrder.num1-t.importOrder.num3)+"单")]),t._v(" "),i("p",[t._v("导入异常："),i("span",{staticStyle:{color:"#ed4014","font-weight":"700"}},[t._v(t._s(t.importOrder.num3))]),t._v("单")])])],1),t._v(" "),i("div",{attrs:{slot:"footer"},slot:"footer"},[i("Button",{attrs:{type:"primary",size:"large",long:"",disabled:t.importOrder.num1+t.importOrder.num3!=t.selectList.length},on:{click:function(e){t.importAlert=!1,t.selectList=[],t.reset(),t.GetOrderNum()}}},[t._v("关闭")])],1)])],1)},staticRenderFns:[]};var s=i("VU/8")(r,a,!1,function(t){i("wkpN")},"data-v-a515cfdc",null);e.default=s.exports},wkpN:function(t,e){}});