webpackJsonp([14],{"7ZLz":function(e,t){},W1Am:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a={data:function(){var e=this;return{spinShow:!1,roleTree:[],cheTree:[],formValidate:{id:-1,roleName:"",roleCode:"",remark:"",supplierExclusive:!1,menuIds:!1},data1:[],like:"",ruleValidate:{roleName:[{message:"请输入角色名称",required:!0,trigger:"blur"}],roleCode:[{message:"请输入角色编号",required:!0,trigger:"blur"}],menuIds:[{validator:function(t,r,a){e.cheTree.length<1?a(new Error("请关联菜单")):a()},required:!0,trigger:"change"}]},id:"",addAccount:!1,total:0,loading:!0,modal_loading:!1,columns:[{type:"index",width:50,align:"center"},{title:"角色名称",minWidth:88,key:"roleName",align:"center"},{title:"角色备注",minWidth:88,key:"remark",align:"center"},{title:"供应商是否专属",minWidth:88,key:"status",align:"center",render:function(e,t){return e("p",!0===t.row.supplierExclusive?"是":"否")}},{title:"最后修改时间",minWidth:88,key:"timeModified",align:"center",render:function(t,r){return t("p",e.riqi(r.row.timeModified))}},{title:"操作",align:"center",minWidth:100,maxWidth:180,render:function(t,r){return t("div",[t("a",{on:{click:function(){var t=e;t.spinShow=!0,t.addAccount=!0,t.id=r.row.id,t.formValidate.id=r.row.id,t.handleReset("formValidate"),t.formValidate.remark=r.row.remark,t.formValidate.roleName=r.row.roleName,t.formValidate.roleCode=r.row.roleCode,t.formValidate.supplierExclusive=r.row.supplierExclusive,t.Axios.post("/GetRoleModel.ashx",{id:Number(r.row.id)}).then(function(e){if(0===e.data.error){for(var r=e.data.data,a=[],o=0;o<r.length;o++)r[o].expand=!0===r[o].checked,r[o].checked=!1,a.push(r[o]);t.roleTree=a,setTimeout(function(){t.cheTree=t.$refs.tree.getCheckedNodes()},1)}else t.$Message.error(e.data.message);t.spinShow=!1})}}},"编辑"),t("Divider",{props:{type:"vertical"}}),t("Poptip",{props:{confirm:!0,transfer:!0,placement:"top-end",offset:13,title:"确定删除该角色？"},on:{"on-ok":function(){var t=e;t.Axios.post("/Manage/Role/deleteRole",t.Qs.stringify({ids:[r.row.id]},{indices:!1})).then(function(e){0===e.data.code?(t.getTreeList(),t.$Message.success("删除成功")):t.$Message.error(e.data.message)})}}},[t("a","删除")])])}}],data:[]}},methods:{getTree:function(){var e=this;e.Axios.get("/GetMenuList.ashx").then(function(t){e.roleTree=t.data.data})},addRole:function(){this.getTree(),this.id="",this.handleReset("formValidate"),this.addAccount=!0},getTreeList:function(){var e=this;e.loading=!0,e.Axios.post("/GetRoleList.ashx",{page:e.start,pagesize:20,roleNameLike:""}).then(function(t){0===t.data.error?e.data=t.data.data:e.$Message.error(t.data.errorMsg),e.loading=!1,e.total=t.data.data.total})},handleSubmit:function(e){var t=this;console.log(t.cheTree);var r=[],a=[],o=[];for(var i in t.cheTree)1===t.cheTree[i].index?r.push(t.cheTree[i].id):2===t.cheTree[i].index?a.push(t.cheTree[i].id):3===t.cheTree[i].index&&o.push(t.cheTree[i].id);console.log(r),console.log(a),console.log(o),t.$refs[e].validate(function(e){if(e)return t.modal_loading=!0,void t.Axios.post("/EditRole.ashx",{id:Number(t.formValidate.id),roleName:t.formValidate.roleName,roleCode:t.formValidate.roleCode,remark:t.formValidate.remark,menuId1:r.join(","),menuId2:a.join(","),menuId3:o.join(","),IsSupplier:t.formValidate.supplierExclusive?0:1}).then(function(e){0===e.data.error?(t.addAccount=!1,t.getTreeList(),t.$Message.success("添加成功")):t.$Message.error(e.data.errorMsg),t.modal_loading=!1});t.$Message.error("有必填项未填写!")})},handleReset:function(e){this.$refs[e].resetFields()},checkTree:function(e){this.cheTree=this.$refs.tree.getCheckedAndIndeterminateNodes()}},mounted:function(){this.getTreeList()}},o={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"content"},[r("Card",{staticStyle:{border:"none",margin:"16px 0"}},[r("div",{staticClass:"ivu-page-header-title"},[e._v("角色管理")])]),e._v(" "),r("Card",{style:{margin:"0 20px 20px 20px",background:"#fff",height:"auto"}},[e.loading?r("Spin",{attrs:{fix:""}}):e._e(),e._v(" "),r("p",{attrs:{slot:"title"},slot:"title"},[e._v("\n      基础列表\n    ")]),e._v(" "),r("Button",{staticStyle:{width:"100%","margin-bottom":"16px"},attrs:{type:"dashed"},on:{click:function(t){e.addRole()}}},[e._v("添加")]),e._v(" "),r("Table",{attrs:{"show-header":!0,columns:e.columns,data:e.data}}),e._v(" "),r("div",{staticStyle:{width:"100%",height:"2px",background:"#ffffff","margin-top":"-1px","z-index":"3",position:"relative"}})],1),e._v(" "),r("Modal",{attrs:{width:"300"},model:{value:e.addAccount,callback:function(t){e.addAccount=t},expression:"addAccount"}},[r("p",{attrs:{slot:"header"},slot:"header"},[r("Icon",{attrs:{type:"ios-information-circle"}}),e._v(" "),r("span",[e._v(e._s(""===e.id?"添加":"修改")+"角色")])],1),e._v(" "),r("div",[e.spinShow?r("Spin",{attrs:{size:"large",fix:""}}):e._e(),e._v(" "),r("Form",{ref:"formValidate",attrs:{model:e.formValidate,rules:e.ruleValidate,"label-width":70}},[r("FormItem",{attrs:{label:"角色名称",prop:"roleName"}},[r("Input",{attrs:{maxlength:10,placeholder:"请输入角色名称"},model:{value:e.formValidate.roleName,callback:function(t){e.$set(e.formValidate,"roleName",t)},expression:"formValidate.roleName"}})],1),e._v(" "),r("FormItem",{attrs:{label:"角色说明",prop:"remark"}},[r("Input",{attrs:{type:"textarea",maxlength:50,placeholder:"请输入角色说明"},model:{value:e.formValidate.remark,callback:function(t){e.$set(e.formValidate,"remark",t)},expression:"formValidate.remark"}})],1),e._v(" "),r("FormItem",{attrs:{"label-width":100,label:"供应商是否专属",prop:"supplierExclusive"}},[r("i-switch",{attrs:{disabled:""!==e.id},model:{value:e.formValidate.supplierExclusive,callback:function(t){e.$set(e.formValidate,"supplierExclusive",t)},expression:"formValidate.supplierExclusive"}},[r("span",{attrs:{slot:"open"},slot:"open"},[e._v("是")]),e._v(" "),r("span",{attrs:{slot:"close"},slot:"close"},[e._v("否")])])],1),e._v(" "),r("FormItem",{attrs:{label:"关联菜单",prop:"menuIds"}},[r("Card",[r("Tree",{ref:"tree",attrs:{data:e.roleTree,"show-checkbox":""},on:{"on-check-change":e.checkTree}})],1)],1)],1)],1),e._v(" "),r("div",{attrs:{slot:"footer"},slot:"footer"},[r("Button",{attrs:{type:"success",size:"large",long:"",loading:e.modal_loading},on:{click:function(t){e.handleSubmit("formValidate")}}},[e._v("\n        "+e._s(""===e.id?"添加":"修改")+"\n      ")])],1)])],1)},staticRenderFns:[]};var i=r("VU/8")(a,o,!1,function(e){r("7ZLz")},"data-v-cf1e5d7c",null);t.default=i.exports}});