webpackJsonp([17],{WfQe:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r={components:{upImg:a("JNXG").a},watch:{$route:function(){this.current=0,this.handleReset("formValidate"),this.handleReset("formValidate1"),this.handleReset("formValidate2")}},props:["supplier"],data:function(){var e=this;return{approvalStatusStr:"",detail:{},current:0,formValidate:{classify:[]},formValidate1:{skuInfoName:"",subTitle:"",brandId:"",description:"",stockType:"",updMethod:"",keyWords:"",pics:[]},formValidate2:{marketPrice:"",price:"",skuInfoNo:"",discount:""},ruleValidate:{classify:[{required:!0,type:"array",min:3,message:"请选择三级分类",trigger:"change"}]},ruleValidate1:{skuInfoName:[{required:!0,message:"请填写名称",trigger:"blur"}],updMethod:[{required:!0,message:"请选择维护方式",trigger:"change"}],stockType:[{required:!0,message:"请选择仓位",trigger:"change"}],pics1:[{validator:function(t,a,r){e.$refs.pics1.uploadList<1?r(new Error("请上传商品题图")):r()},required:!0,trigger:"change"}],pics2:[{validator:function(t,a,r){e.$refs.pics2.uploadList<1?r(new Error("请上传商品详情图")):r()},required:!0,trigger:"change"}]},ruleValidate2:{marketPrice:[{required:!0,message:"请填写市场价",trigger:"blur"}],price:[{required:!0,message:"请填写售价",trigger:"blur"}],skuInfoNo:[{validator:function(t,a,r){var i=e;a?i.Axios.get("/Manage/SkuInfo/validSkuInfoNo",{params:{id:i.$route.query.id?i.$route.query.id:"",skuInfoNo:a}}).then(function(e){0===e.data.code?r():r(new Error("商品编号重复"))}):r(new Error("请输入商品编号"))},required:!0,trigger:"blur"}]},treeData:[],brandList:[],tag:[]}},methods:{handleSubmit:function(e){var t=this;t.formValidate1.pics=[];for(var a=t.$refs.pics1.uploadList,r=t.$refs.pics2.uploadList,i=0;i<a.length;i++)t.formValidate1.pics.push({filePath:a[i].filename,fileType:"PICTURE",albumsSeq:i,detailPic:!1});for(var o=0;o<r.length;o++)t.formValidate1.pics.push({filePath:r[o].filename,fileType:"PICTURE",albumsSeq:o,detailPic:!0});t.$refs[e].validate(function(a){a?"formValidate"===e?t.current=1:"formValidate1"===e?t.current=2:t.Axios.post(t.$route.query.id?"/Manage/SkuInfo/update":"/Manage/SkuInfo/insert",{id:t.$route.query.id?t.$route.query.id:"",approvalStatusStr:t.approvalStatusStr,categoryId:t.formValidate.classify[2],category1:t.formValidate.classify[0],category2:t.formValidate.classify[1],category3:t.formValidate.classify[2],skuInfoName:t.formValidate1.skuInfoName,subTitle:t.formValidate1.subTitle,skuInfoPicUrl:t.$refs.pics1.uploadList[0].filename,brandId:t.formValidate1.brandId,keyWords:t.tag.join(" "),description:t.formValidate1.description,pics:t.formValidate1.pics,stockType:"1"===t.supplier.supplierId?t.formValidate1.stockType:"GYS",updMethod:"1"===t.supplier.supplierId?t.formValidate1.updMethod:"MANUAL",marketPrice:t.formValidate2.marketPrice,discount:t.formValidate2.discount,price:t.formValidate2.price,skuInfoNo:t.formValidate2.skuInfoNo,fullSkuInfoNo:t.supplier.supplierNo+t.formValidate2.skuInfoNo}).then(function(e){0===e.data.code?(t.current=3,t.handleReset("formValidate"),t.handleReset("formValidate1"),t.handleReset("formValidate2")):t.$Message.warning(e.data.message)}):t.$Message.error("有必填项未填写!")})},handleReset:function(e){this.$refs[e].resetFields(),this.tag=[],this.$refs.pics1.handleRemove1(0),this.$refs.pics2.handleRemove1(0)},getDetail:function(){var e=this;e.Axios.get("/Manage/SkuInfo/detail",{params:{id:e.$route.query.id}}).then(function(t){for(var a in console.log(t.data),e.formValidate={classify:[t.data.data.category1,t.data.data.category2,t.data.data.category3]},e.formValidate1={skuInfoName:t.data.data.skuInfoName,subTitle:t.data.data.subTitle,brandId:t.data.data.brandId,description:t.data.data.description,stockType:t.data.data.stockType,updMethod:t.data.data.updMethod},t.data.data.mianPics)e.$refs.pics1.defaultList.push({filename:t.data.data.mianPics[a].filePath});for(var r in t.data.data.detailPics)e.$refs.pics2.defaultList.push({filename:t.data.data.detailPics[r].filePath});e.formValidate2={marketPrice:String(t.data.data.marketPrice),price:String(t.data.data.price),discount:t.data.data.discount,skuInfoNo:t.data.data.skuInfoNo},e.tag=t.data.data.keyWords.split(" ")})},addTag:function(){this.tag.length<10&&""!==this.formValidate1.keyWords&&(this.tag.push(this.formValidate1.keyWords),this.formValidate1.keyWords="")},handleClose:function(e){this.tag.splice(e,1)},getTree:function(){var e=this;e.Axios.get("/Manage/Category/treeList").then(function(t){e.treeData=t.data.data})},getBrand:function(){var e=this;e.Axios.get("/Manage/Brand/selectBrand").then(function(t){e.brandList=t.data.data})}},mounted:function(){this.getTree(),this.getBrand(),this.$route.query.id&&this.getDetail()}},i={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"content"},[a("Card",{staticStyle:{border:"none",margin:"16px 0"}},[a("div",{staticClass:"ivu-page-header-title"},[e._v(e._s(e.$route.query.id?"编辑商品":"新建商品"))])]),e._v(" "),a("Card",{style:{margin:"16px 20px",background:"#fff",height:"auto",minHeight:"300px"}},[a("Row",[a("Col",{attrs:{md:{span:18,offset:3},lg:{span:10,offset:6}}},[3!==e.current?a("Steps",{staticStyle:{margin:"16px 0 32px 0"},attrs:{current:e.current}},[a("Step",{attrs:{title:"选择商品分类"}}),e._v(" "),a("Step",{attrs:{title:"填写商品信息"}}),e._v(" "),a("Step",{attrs:{title:"填写商品属性"}})],1):e._e(),e._v(" "),a("Row",{directives:[{name:"show",rawName:"v-show",value:0===e.current,expression:"current===0"}]},[a("Col",{attrs:{span:"24"}},[a("Form",{ref:"formValidate",attrs:{model:e.formValidate,rules:e.ruleValidate,"label-width":70}},[a("FormItem",{attrs:{label:"商品分类",prop:"classify"}},[a("Cascader",{attrs:{data:e.treeData},model:{value:e.formValidate.classify,callback:function(t){e.$set(e.formValidate,"classify",t)},expression:"formValidate.classify"}})],1),e._v(" "),a("FormItem",[a("Button",{staticStyle:{"margin-top":"16px"},attrs:{type:"primary"},on:{click:function(t){e.handleSubmit("formValidate")}}},[e._v("下一步，填写商品信息\n                ")])],1)],1)],1)],1),e._v(" "),a("Row",{directives:[{name:"show",rawName:"v-show",value:1===e.current,expression:"current===1"}]},[a("Form",{ref:"formValidate1",attrs:{model:e.formValidate1,rules:e.ruleValidate1,"label-width":70}},[a("Col",{attrs:{span:"24"}},[a("FormItem",{attrs:{label:"商品名称",prop:"skuInfoName"}},[a("Input",{attrs:{maxlength:200,placeholder:"请输入"},model:{value:e.formValidate1.skuInfoName,callback:function(t){e.$set(e.formValidate1,"skuInfoName",t)},expression:"formValidate1.skuInfoName"}})],1),e._v(" "),a("FormItem",{attrs:{label:"副标题",prop:"subTitle"}},[a("Input",{attrs:{maxlength:60,placeholder:"请输入"},model:{value:e.formValidate1.subTitle,callback:function(t){e.$set(e.formValidate1,"subTitle",t)},expression:"formValidate1.subTitle"}})],1),e._v(" "),a("FormItem",{attrs:{label:"商品品牌",prop:"brandId"}},[a("Select",{attrs:{clearable:!0},model:{value:e.formValidate1.brandId,callback:function(t){e.$set(e.formValidate1,"brandId",t)},expression:"formValidate1.brandId"}},e._l(e.brandList,function(t,r){return a("Option",{key:r,attrs:{value:t.id}},[e._v(e._s(t.brandName))])}))],1),e._v(" "),"1"===e.supplier.supplierId?a("FormItem",{attrs:{label:"维护",prop:"updMethod"}},[a("Select",{attrs:{disabled:!!e.$route.query.id,clearable:!0},model:{value:e.formValidate1.updMethod,callback:function(t){e.$set(e.formValidate1,"updMethod",t)},expression:"formValidate1.updMethod"}},[a("Option",{attrs:{value:"AUTO"}},[e._v("自动更新")]),e._v(" "),a("Option",{attrs:{value:"MANUAL"}},[e._v("手动维护")]),e._v(" "),a("Option",{attrs:{value:"BATCH"}},[e._v("自动回滚")])],1)],1):e._e(),e._v(" "),"1"===e.supplier.supplierId&&e.formValidate1.updMethod?a("FormItem",{attrs:{label:"仓位",prop:"stockType"}},[a("Select",{attrs:{disabled:!!e.$route.query.id,clearable:!0},model:{value:e.formValidate1.stockType,callback:function(t){e.$set(e.formValidate1,"stockType",t)},expression:"formValidate1.stockType"}},["MANUAL"===e.formValidate1.updMethod?a("Option",{attrs:{value:"DF"}},[e._v("代发")]):e._e(),e._v(" "),"BATCH"===e.formValidate1.updMethod?a("Option",{attrs:{value:"NHJ"}},[e._v("南华街")]):e._e(),e._v(" "),"AUTO"===e.formValidate1.updMethod?a("Option",{attrs:{value:"JS"}},[e._v("嘉善")]):e._e()],1)],1):e._e(),e._v(" "),a("FormItem",{attrs:{label:"商品介绍",prop:"description"}},[a("Input",{attrs:{rows:3,maxlength:80,type:"textarea",placeholder:"请输入"},model:{value:e.formValidate1.description,callback:function(t){e.$set(e.formValidate1,"description",t)},expression:"formValidate1.description"}})],1),e._v(" "),a("FormItem",{attrs:{label:"运费",prop:"brandStory"}},[e._v("\n                包邮\n              ")]),e._v(" "),a("FormItem",{attrs:{label:"关键词",prop:"keyWords"}},[a("Input",{staticStyle:{width:"150px"},attrs:{search:"","enter-button":"添加",maxlength:5,placeholder:"请输入"},on:{"on-search":e.addTag},model:{value:e.formValidate1.keyWords,callback:function(t){e.$set(e.formValidate1,"keyWords",t)},expression:"formValidate1.keyWords"}}),e._v(" "),a("Row",{staticStyle:{"margin-top":"8px"}},[a("Col",{attrs:{span:"24"}},e._l(e.tag,function(t,r){return a("Tag",{key:r,attrs:{type:"border",closable:""},on:{"on-close":function(t){e.handleClose(r)}}},[e._v("\n                      "+e._s(t)+"\n                    ")])}))],1)],1),e._v(" "),a("FormItem",{attrs:{label:"题图 (大小1MB)",prop:"pics1"}},[a("upImg",{ref:"pics1",attrs:{num:6}})],1),e._v(" "),a("FormItem",{attrs:{label:"详情图 (大小1MB)",prop:"pics2"}},[a("upImg",{ref:"pics2",attrs:{num:6}})],1),e._v(" "),a("FormItem",[a("Button",{staticStyle:{"margin-right":"16px"},attrs:{type:"primary",ghost:""},on:{click:function(t){e.current=0}}},[e._v("上一步，选择商品分类")]),e._v(" "),a("Button",{attrs:{type:"primary"},on:{click:function(t){e.handleSubmit("formValidate1")}}},[e._v("下一步，填写商品属性")])],1)],1)],1)],1),e._v(" "),a("Row",{directives:[{name:"show",rawName:"v-show",value:2===e.current,expression:"current===2"}]},[a("Form",{ref:"formValidate2",attrs:{model:e.formValidate2,rules:e.ruleValidate2,"label-width":70}},[a("Col",{attrs:{span:"24"}},[a("FormItem",{attrs:{label:"市场价",prop:"marketPrice"}},[a("Input",{attrs:{maxlength:7,placeholder:"请输入"},on:{"on-keyup":function(t){e.formValidate2.marketPrice=e.formValidate2.marketPrice.match(/\d+(\.\d{0,2})?/)?e.formValidate2.marketPrice.match(/\d+(\.\d{0,2})?/)[0]:""}},model:{value:e.formValidate2.marketPrice,callback:function(t){e.$set(e.formValidate2,"marketPrice",t)},expression:"formValidate2.marketPrice"}})],1),e._v(" "),a("FormItem",{attrs:{label:"售价",prop:"price"}},[a("Input",{attrs:{maxlength:7,placeholder:"请输入"},on:{"on-keyup":function(t){e.formValidate2.price=e.formValidate2.price.match(/\d+(\.\d{0,2})?/)?e.formValidate2.price.match(/\d+(\.\d{0,2})?/)[0]:""}},model:{value:e.formValidate2.price,callback:function(t){e.$set(e.formValidate2,"price",t)},expression:"formValidate2.price"}})],1),e._v(" "),a("FormItem",{attrs:{label:"折扣",prop:"discount"}},[a("Input",{attrs:{maxlength:15,placeholder:"折扣为（0.1~9.9）之间"},on:{"on-keyup":function(t){e.formValidate2.discount=e.formValidate2.discount.match(/\d+(\.\d{0,1})?/)?e.formValidate2.discount.match(/\d+(\.\d{0,1})?/)[0]:""}},model:{value:e.formValidate2.discount,callback:function(t){e.$set(e.formValidate2,"discount",t)},expression:"formValidate2.discount"}})],1),e._v(" "),a("FormItem",{attrs:{label:"SKU编号",prop:"skuInfoNo"}},[a("Input",{attrs:{disabled:!!e.$route.query.id,maxlength:10,placeholder:"请输入"},on:{"on-keyup":function(t){e.formValidate2.skuInfoNo=e.formValidate2.skuInfoNo.replace(/[^\w\.\/]/gi,"")}},model:{value:e.formValidate2.skuInfoNo,callback:function(t){e.$set(e.formValidate2,"skuInfoNo",t)},expression:"formValidate2.skuInfoNo"}})],1),e._v(" "),a("FormItem",[a("Button",{staticStyle:{"margin-right":"16px"},attrs:{type:"primary",ghost:""},on:{click:function(t){e.current=1}}},[e._v("上一步，填写商品信息")]),e._v(" "),e.$route.query.id?a("Poptip",{attrs:{confirm:"",title:"修改后将会在所有平台下架，是否确定？"},on:{"on-ok":function(t){e.handleSubmit("formValidate2")}}},[a("Button",{attrs:{type:"primary"}},[e._v("提交修改")])],1):[a("Button",{attrs:{type:"primary"},on:{click:function(t){e.approvalStatusStr="AUDITING",e.handleSubmit("formValidate2")}}},[e._v("保存，并提交审核")])]],2)],1)],1)],1)],1)],1),e._v(" "),a("Row",{directives:[{name:"show",rawName:"v-show",value:3===e.current,expression:"current===3"}]},[a("Col",{staticStyle:{"text-align":"center"},attrs:{span:"24"}},[a("Icon",{staticStyle:{margin:"32px 0 24px 0"},attrs:{type:"ios-checkmark-circle",size:"90",color:"#19be6b"}}),e._v(" "),a("div",{staticClass:"ivu-result-title"},[e._v(e._s(e.$route.query.id?"修改成功":"添加成功"))]),e._v(" "),a("Alert",{staticStyle:{width:"50%",margin:"0 auto 32px auto","font-size":"14px","text-align":"left",padding:"16px"}},[e._v("\n          "+e._s(e.$route.query.id?"商品修改成功！":"已提交申请，等待审核")+"\n        ")]),e._v(" "),a("Button",{directives:[{name:"show",rawName:"v-show",value:!e.$route.query.id,expression:"!$route.query.id"}],attrs:{type:"primary"},on:{click:function(t){e.current=0}}},[e._v("继续新建")])],1)],1)],1)],1)},staticRenderFns:[]};var o=a("VU/8")(r,i,!1,function(e){a("jhhB")},"data-v-a5355eec",null);t.default=o.exports},jhhB:function(e,t){}});